<section class="giscus mx-auto mt-10 w-full"></section>

<script is:inline>
  function getGiscusTheme() {
    // Convert your daisyUI theme to a giscus theme string
    return document.documentElement.getAttribute('data-theme') === 'darkCustom'
      ? 'noborder_dark'
      : 'noborder_light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const theme = getGiscusTheme();
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', 'frockett/astro-portfolio-website');
    script.setAttribute('data-repo-id', 'R_kgDOMSNwUg');
    script.setAttribute('data-category', 'Blog Post Comments');
    script.setAttribute('data-category-id', 'DIC_kwDOMSNwUs4Cm9Ou');
    script.setAttribute('data-mapping', 'url');
    script.setAttribute('data-strict', '1');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'top');
    script.setAttribute('data-theme', theme);
    script.setAttribute('data-lang', 'en');
    script.setAttribute('data-loading', 'lazy');
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;
    document.querySelector('.giscus').appendChild(script);
  });

  // Also update the theme on toggle changes
  document.getElementById('themeToggle')?.addEventListener('change', () => {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme: getGiscusTheme() } } },
      'https://giscus.app'
    );
  });
</script>
